<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 880 740" fill="none">
  <style>
    text { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; }
    .title { font-size: 13px; font-weight: 600; fill: #1e293b; }
    .subtitle { font-size: 10.5px; fill: #64748b; }
    .tag { font-size: 9.5px; fill: #64748b; font-family: 'SF Mono', 'Cascadia Code', 'Fira Code', monospace; }
    .section { font-size: 10px; font-weight: 600; fill: #94a3b8; letter-spacing: 2px; }
    .data-title { font-size: 11px; font-weight: 600; fill: #475569; }
    .data-sub { font-size: 9px; fill: #94a3b8; }
    .tool-text { font-size: 9px; fill: #475569; font-family: 'SF Mono', 'Cascadia Code', 'Fira Code', monospace; }
  </style>

  <defs>
    <marker id="arr" viewBox="0 0 8 6" refX="8" refY="3" markerWidth="8" markerHeight="6" orient="auto">
      <path d="M0,0.5 L7,3 L0,5.5" fill="none" stroke="#94a3b8" stroke-width="1.2" stroke-linejoin="round"/>
    </marker>
    <marker id="arr-pink" viewBox="0 0 8 6" refX="8" refY="3" markerWidth="8" markerHeight="6" orient="auto">
      <path d="M0,0.5 L7,3 L0,5.5" fill="none" stroke="#e879a0" stroke-width="1.2" stroke-linejoin="round"/>
    </marker>
    <marker id="arr-violet" viewBox="0 0 8 6" refX="8" refY="3" markerWidth="8" markerHeight="6" orient="auto">
      <path d="M0,0.5 L7,3 L0,5.5" fill="none" stroke="#c4b5fd" stroke-width="1.2" stroke-linejoin="round"/>
    </marker>
    <filter id="shadow" x="-4%" y="-4%" width="108%" height="112%">
      <feDropShadow dx="0" dy="1" stdDeviation="3" flood-color="#0f172a" flood-opacity="0.06"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="880" height="740" rx="16" fill="#f8fafc"/>

  <!-- ======================== -->
  <!--    INTERACTIVE  FLOW     -->
  <!-- ======================== -->

  <text x="240" y="30" class="section" text-anchor="middle">INTERACTIVE FLOW</text>

  <!-- Telegram User -->
  <rect x="140" y="44" width="200" height="50" rx="25" fill="#dbeafe" stroke="#93c5fd" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="240" y="73" class="title" text-anchor="middle" fill="#1e40af">Telegram User</text>

  <!-- Arrow: User -> Bot -->
  <line x1="240" y1="94" x2="240" y2="126" stroke="#94a3b8" stroke-width="1.3" marker-end="url(#arr)"/>

  <!-- bot.py -->
  <rect x="135" y="130" width="210" height="56" rx="12" fill="#ffffff" stroke="#f59e0b" stroke-width="1.3" filter="url(#shadow)"/>
  <rect x="135" y="130" width="210" height="18" rx="12" fill="#fef3c7"/>
  <rect x="135" y="140" width="210" height="8" fill="#fef3c7"/>
  <text x="240" y="157" class="title" text-anchor="middle">bot.py</text>
  <text x="240" y="175" class="subtitle" text-anchor="middle">Auth Check &amp; Message Routing</text>

  <!-- Arrow: Bot -> Agent -->
  <line x1="240" y1="186" x2="240" y2="218" stroke="#94a3b8" stroke-width="1.3" marker-end="url(#arr)"/>

  <!-- agent.py (hero card) -->
  <rect x="80" y="222" width="320" height="72" rx="14" fill="#ffffff" stroke="#7c3aed" stroke-width="1.5" filter="url(#shadow)"/>
  <rect x="80" y="222" width="320" height="20" rx="14" fill="#ede9fe"/>
  <rect x="80" y="234" width="320" height="8" fill="#ede9fe"/>
  <text x="240" y="256" class="title" text-anchor="middle" fill="#5b21b6">agent.py</text>
  <text x="240" y="274" class="subtitle" text-anchor="middle">Claude Code SDK + Session Management</text>
  <text x="240" y="288" class="tag" text-anchor="middle">run_agent() &amp; run_task_agent()</text>

  <!-- Two arrows down to tools -->
  <line x1="170" y1="294" x2="150" y2="340" stroke="#94a3b8" stroke-width="1.3" marker-end="url(#arr)"/>
  <line x1="310" y1="294" x2="330" y2="340" stroke="#94a3b8" stroke-width="1.3" marker-end="url(#arr)"/>

  <!-- Built-in Tools -->
  <rect x="40" y="344" width="210" height="110" rx="12" fill="#ffffff" stroke="#10b981" stroke-width="1.2" filter="url(#shadow)"/>
  <rect x="40" y="344" width="210" height="18" rx="12" fill="#d1fae5"/>
  <rect x="40" y="354" width="210" height="8" fill="#d1fae5"/>
  <text x="145" y="380" class="title" text-anchor="middle" fill="#065f46">Built-in Tools</text>
  <text x="145" y="398" class="tool-text" text-anchor="middle">Bash  Read  Write  Edit</text>
  <text x="145" y="413" class="tool-text" text-anchor="middle">Glob  Grep</text>
  <text x="145" y="428" class="tool-text" text-anchor="middle">WebSearch  WebFetch</text>
  <text x="145" y="446" class="data-sub" text-anchor="middle">8 tools</text>

  <!-- Custom MCP Tools -->
  <rect x="270" y="344" width="210" height="110" rx="12" fill="#ffffff" stroke="#3b82f6" stroke-width="1.2" filter="url(#shadow)"/>
  <rect x="270" y="344" width="210" height="18" rx="12" fill="#dbeafe"/>
  <rect x="270" y="354" width="210" height="8" fill="#dbeafe"/>
  <text x="375" y="380" class="title" text-anchor="middle" fill="#1e40af">Custom MCP Tools</text>
  <text x="375" y="398" class="tool-text" text-anchor="middle">send_message</text>
  <text x="375" y="413" class="tool-text" text-anchor="middle">schedule_task  list_tasks</text>
  <text x="375" y="428" class="tool-text" text-anchor="middle">pause  resume  cancel</text>
  <text x="375" y="446" class="data-sub" text-anchor="middle">6 tools</text>

  <!-- Converge arrows: Tools -> Archive -->
  <line x1="145" y1="454" x2="200" y2="494" stroke="#94a3b8" stroke-width="1.3" marker-end="url(#arr)"/>
  <line x1="375" y1="454" x2="290" y2="494" stroke="#94a3b8" stroke-width="1.3" marker-end="url(#arr)"/>

  <!-- conversations.py -->
  <rect x="135" y="494" width="210" height="56" rx="12" fill="#ffffff" stroke="#f59e0b" stroke-width="1.2" filter="url(#shadow)"/>
  <rect x="135" y="494" width="210" height="18" rx="12" fill="#fef3c7"/>
  <rect x="135" y="504" width="210" height="8" fill="#fef3c7"/>
  <text x="240" y="522" class="title" text-anchor="middle">conversations.py</text>
  <text x="240" y="540" class="subtitle" text-anchor="middle">Archive to Daily Markdown</text>

  <!-- Arrow: Archive -> Reply -->
  <line x1="240" y1="550" x2="240" y2="582" stroke="#94a3b8" stroke-width="1.3" marker-end="url(#arr)"/>

  <!-- Reply pill -->
  <rect x="155" y="586" width="170" height="38" rx="19" fill="#dbeafe" stroke="#93c5fd" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="240" y="610" class="title" text-anchor="middle" fill="#1e40af">Reply to User</text>


  <!-- ======================== -->
  <!--    SCHEDULER  FLOW       -->
  <!-- ======================== -->

  <!-- Vertical divider -->
  <line x1="510" y1="44" x2="510" y2="624" stroke="#e2e8f0" stroke-width="1" stroke-dasharray="6,4"/>

  <text x="680" y="30" class="section" text-anchor="middle">BACKGROUND SCHEDULER</text>

  <!-- APScheduler -->
  <rect x="565" y="44" width="230" height="56" rx="12" fill="#ffffff" stroke="#ec4899" stroke-width="1.3" filter="url(#shadow)"/>
  <rect x="565" y="44" width="230" height="18" rx="12" fill="#fce7f3"/>
  <rect x="565" y="54" width="230" height="8" fill="#fce7f3"/>
  <text x="680" y="72" class="title" text-anchor="middle" fill="#9d174d">scheduler.py</text>
  <text x="680" y="89" class="subtitle" text-anchor="middle">APScheduler (every 60s)</text>

  <!-- Arrow: Scheduler -> Check -->
  <line x1="680" y1="100" x2="680" y2="136" stroke="#e879a0" stroke-width="1.3" marker-end="url(#arr-pink)"/>

  <!-- Check due tasks -->
  <rect x="565" y="140" width="230" height="50" rx="12" fill="#ffffff" stroke="#ec4899" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="680" y="163" class="title" text-anchor="middle">Check Due Tasks</text>
  <text x="680" y="181" class="tag" text-anchor="middle">db.get_due_tasks()</text>

  <!-- Arrow: Check -> Execute -->
  <line x1="680" y1="190" x2="680" y2="228" stroke="#e879a0" stroke-width="1.3" marker-end="url(#arr-pink)"/>

  <!-- Execute task -->
  <rect x="565" y="232" width="230" height="60" rx="12" fill="#ffffff" stroke="#ec4899" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="680" y="258" class="title" text-anchor="middle">Execute Task</text>
  <text x="680" y="277" class="tag" text-anchor="middle">run_task_agent(prompt)</text>

  <!-- Dotted line: Execute -> Agent (shared SDK) -->
  <line x1="565" y1="258" x2="400" y2="258" stroke="#c4b5fd" stroke-width="1.2" stroke-dasharray="5,4" marker-end="url(#arr-violet)"/>
  <text x="483" y="250" class="data-sub" text-anchor="middle">shared SDK</text>

  <!-- Arrow: Execute -> Log -->
  <line x1="680" y1="292" x2="680" y2="328" stroke="#e879a0" stroke-width="1.3" marker-end="url(#arr-pink)"/>

  <!-- Log & Update -->
  <rect x="565" y="332" width="230" height="56" rx="12" fill="#ffffff" stroke="#ec4899" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="680" y="357" class="title" text-anchor="middle">Log &amp; Update</text>
  <text x="680" y="375" class="tag" text-anchor="middle">task_run_logs + next_run</text>

  <!-- Loop arrow back to scheduler -->
  <path d="M 805 354 Q 840 354 840 200 Q 840 68 805 68" stroke="#e879a0" stroke-width="1.2" fill="none" stroke-dasharray="5,4" marker-end="url(#arr-pink)"/>
  <text x="852" y="216" class="data-sub" fill="#ec4899" transform="rotate(-90, 852, 216)">loop</text>

  <!-- Notify user (optional) -->
  <path d="M 565 362 Q 520 420 400 505" stroke="#c4b5fd" stroke-width="1" fill="none" stroke-dasharray="4,4" marker-end="url(#arr-violet)"/>
  <text x="508" y="425" class="data-sub" fill="#a78bfa" transform="rotate(-55, 508, 425)">send_message</text>


  <!-- ======================== -->
  <!--     DATA  LAYER          -->
  <!-- ======================== -->

  <text x="440" y="660" class="section" text-anchor="middle">DATA PERSISTENCE</text>

  <!-- Data layer background -->
  <rect x="40" y="672" width="800" height="58" rx="12" fill="#f1f5f9" stroke="#e2e8f0" stroke-width="1"/>

  <!-- State -->
  <rect x="58" y="680" width="170" height="42" rx="8" fill="#ffffff" stroke="#cbd5e1" stroke-width="1"/>
  <text x="143" y="698" class="data-title" text-anchor="middle">state.json</text>
  <text x="143" y="713" class="data-sub" text-anchor="middle">Session Continuity</text>

  <!-- Memory -->
  <rect x="248" y="680" width="170" height="42" rx="8" fill="#ffffff" stroke="#cbd5e1" stroke-width="1"/>
  <text x="333" y="698" class="data-title" text-anchor="middle">CLAUDE.md</text>
  <text x="333" y="713" class="data-sub" text-anchor="middle">Long-term Memory</text>

  <!-- Conversations -->
  <rect x="438" y="680" width="175" height="42" rx="8" fill="#ffffff" stroke="#cbd5e1" stroke-width="1"/>
  <text x="525" y="698" class="data-title" text-anchor="middle">conversations/</text>
  <text x="525" y="713" class="data-sub" text-anchor="middle">Daily Chat Archives</text>

  <!-- Tasks DB -->
  <rect x="633" y="680" width="190" height="42" rx="8" fill="#ffffff" stroke="#cbd5e1" stroke-width="1"/>
  <text x="728" y="698" class="data-title" text-anchor="middle">nanoclaw.db</text>
  <text x="728" y="713" class="data-sub" text-anchor="middle">Scheduled Tasks (SQLite)</text>

  <!-- Arrows from flows to data layer -->
  <line x1="240" y1="624" x2="240" y2="668" stroke="#94a3b8" stroke-width="1" stroke-dasharray="4,3" marker-end="url(#arr)"/>
  <line x1="680" y1="388" x2="680" y2="668" stroke="#e879a0" stroke-width="1" stroke-dasharray="4,3" marker-end="url(#arr-pink)"/>

</svg>
